Title: CVE-2013-2596 本地提权漏洞
Slug: cve-2013-2596
Date: 2013-10-17 13:10:58
Tags: Security, linux, 
Category: Security
Author: ir193


[cve-2013-2596][1]本地提权漏洞，于2013年4月13日公布，影响版本3.8.9之前（的某些特定版本？）

<!--more-->

网上相关资料相对较少。网上一般的介绍说是影响“某些Motorola手机和其他产品” ，但是实际上引起漏洞的文件位于 `/drivers/video/fbmem.c`。目前还不清楚实际的影响范围。从xda论坛的情况来看，影响范围远远不止motorola手机，包括SAMSUNG Galaxy S4（启用SE linux），Galaxy Tablet 7，Acer A700，Sony Xperia Tablet S等等大量使用Android系统的手机和平板电脑都受影响。

手上的手机，联想860i、华为荣耀四核，全部受这个漏洞影响。其中，联想860i不能成功提权但是重启，华为U9806成功提权。

根据目前搜到的信息，最早发布的exploit是xda论坛上的[motochopper][2]，只是作为工具发布，没有源代码和原理分析。

另外xda论坛上有人根据[motochopper][2]做逆向分析，猜测了原理。重新写出的利用工具[kernelchopper](http://forum.xda-developers.com/showthread.php?p=40873964)，开源，但比较不好用，只提供了写内存功能，需要自己写内存。

### 利用方法 ###

[Patch地址](https://github.com/torvalds/linux/commit/fc9bbca8f650e5f738af8806317c0a041a48ae4a)
目前都这个漏洞的原理还没有搞清楚。应该是个整数溢出漏洞，而且属于相当容易利用的。使用mmap可以直接将内核空间map到用户空间上。

motochopper将内存映射之后，修改了当前用户的uid，从2000(shell)到0(root)。

而xda论坛上介绍的方法是找到`sys_setuid`代码的内存地址，爆破。

	c0077650 <sys_setuid>:
	c0077650:       e92d40f8        push    {r3, r4, r5, r6, r7, lr}
	c0077654:       e1a05000        mov     r5, r0
	c0077658:       eb0040d6        bl      c00879b8 <prepare_creds>
	c007765c:       e2504000        subs    r4, r0, #0
	c0077660:       0a000027        beq     c0077704 <sys_setuid+0xb4>
	c0077664:       e1a0200d        mov     r2, sp
	c0077668:       e3c23d7f        bic     r3, r2, #8128   ; 0x1fc0
	c007766c:       e3c3303f        bic     r3, r3, #63     ; 0x3f
	c0077670:       e3a00007        mov     r0, #7
	c0077674:       e593300c        ldr     r3, [r3, #12]
	c0077678:       e59362fc        ldr     r6, [r3, #764]  ; 0x2fc
	c007767c:       ebffd80f        bl      c006d6c0 <nsown_capable>
	c0077680:       e3500000        cmp     r0, #0
	c0077684:       1a00000a        bne     c00776b4 <sys_setuid+0x64>


这里有另一篇分析 http://securityblog.org/2013/04/30/SE-Android-and-the-motochopper-exploit/

[1]: http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2013-2596
[2]: http://forum.xda-developers.com/showthread.php?t=2252248&page=4
