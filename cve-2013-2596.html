<!doctype html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <title>Another Blog</title>

    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
    <meta name="description" content="yet another blog.">

    <link rel="stylesheet" href="/theme/css/pure-min.css" type="text/css" media="all" />
<!--[if lte IE 8]>
    <link rel="stylesheet" href="/grids-responsive-old-ie-min.css">
<![endif]-->
<!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/theme/css/grids-responsive-min.css" type="text/css" media="all" />
<!--<![endif]-->
    <link rel="stylesheet" href="/theme/css/blog.css" type="text/css" media="all" />
    <link rel="stylesheet" href="/theme/css/ty.css" type="text/css" media="all" />
    <link rel="stylesheet" href="/theme/css/highlight.css" type="text/css" media="all" />

    <link href="https://ir193.github.io/feeds/all.rss.xml" type="application/atom+xml" rel="alternate" title="Another Blog Full Atom Feed" />
    <link href="https://ir193.github.io/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Another Blog Categories Atom Feed" />
    <link href="https://ir193.github.io/feeds/{slug}.rss.xml" type="application/rss+xml" rel="alternate" title="Another Blog Categories RSS Feed" />
    
</head>
<body>

<div id="layout" class="ty pure-g">
    <div class="sidebar pure-u-1 pure-u-md-6-24">
        <div class="header">
            <nav class="navi">
                <span><a href=".">Home</a></span>
                <span class="no-mobile"><a href="./category/life.html">Life</a></span>
                <span class="no-mobile"><a href="./category/security.html">Security</a></span>
                <!-- <span><a href="#">Projects</a></span> -->
                <span><a href="./pages/about.html">About</a></span>
            </nav>
        </div>
    </div>
    <div class="content pure-u-1 pure-u-md-12-24">
        <div class="artical">
<artical class="post post-preview">
    <div class="post-header">
        <h2 class="post-title">
            <a href="./cve-2013-2596.html" rel="bookmark" title="CVE-2013-2596 本地提权漏洞">
                CVE-2013-2596 本地提权漏洞
            </a>
        </h2>
    </div>
    <div class="post-content">
        <p><a href="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2013-2596">cve-2013-2596</a>本地提权漏洞，于2013年4月13日公布，影响版本3.8.9之前（的某些特定版本？）</p>
<!--more-->

<p>网上相关资料相对较少。网上一般的介绍说是影响“某些Motorola手机和其他产品” ，但是实际上引起漏洞的文件位于 <code>/drivers/video/fbmem.c</code>。目前还不清楚实际的影响范围。从xda论坛的情况来看，影响范围远远不止motorola手机，包括SAMSUNG Galaxy S4（启用SE linux），Galaxy Tablet 7，Acer A700，Sony Xperia Tablet S等等大量使用Android系统的手机和平板电脑都受影响。</p>
<p>手上的手机，联想860i、华为荣耀四核，全部受这个漏洞影响。其中，联想860i不能成功提权但是重启，华为U9806成功提权。</p>
<p>根据目前搜到的信息，最早发布的exploit是xda论坛上的<a href="http://forum.xda-developers.com/showthread.php?t=2252248&amp;page=4">motochopper</a>，只是作为工具发布，没有源代码和原理分析。</p>
<p>另外xda论坛上有人根据<a href="http://forum.xda-developers.com/showthread.php?t=2252248&amp;page=4">motochopper</a>做逆向分析，猜测了原理。重新写出的利用工具<a href="http://forum.xda-developers.com/showthread.php?p=40873964">kernelchopper</a>，开源，但比较不好用，只提供了写内存功能，需要自己写内存。</p>
<h3>利用方法</h3>
<p><a href="https://github.com/torvalds/linux/commit/fc9bbca8f650e5f738af8806317c0a041a48ae4a">Patch地址</a>
目前都这个漏洞的原理还没有搞清楚。应该是个整数溢出漏洞，而且属于相当容易利用的。使用mmap可以直接将内核空间map到用户空间上。</p>
<p>motochopper将内存映射之后，修改了当前用户的uid，从2000(shell)到0(root)。</p>
<p>而xda论坛上介绍的方法是找到<code>sys_setuid</code>代码的内存地址，爆破。</p>
<div class="highlight"><pre><span></span><code><span class="nt">c0077650</span> <span class="o">&lt;</span><span class="nt">sys_setuid</span><span class="o">&gt;:</span>
<span class="nt">c0077650</span><span class="o">:</span>       <span class="nt">e92d40f8</span>        <span class="nt">push</span>    <span class="p">{</span><span class="err">r3,</span> <span class="err">r4,</span> <span class="err">r5,</span> <span class="err">r6,</span> <span class="err">r7,</span> <span class="err">lr</span><span class="p">}</span>
<span class="nt">c0077654</span><span class="o">:</span>       <span class="nt">e1a05000</span>        <span class="nt">mov</span>     <span class="nt">r5</span><span class="o">,</span> <span class="nt">r0</span>
<span class="nt">c0077658</span><span class="o">:</span>       <span class="nt">eb0040d6</span>        <span class="nt">bl</span>      <span class="nt">c00879b8</span> <span class="o">&lt;</span><span class="nt">prepare_creds</span><span class="o">&gt;</span>
<span class="nt">c007765c</span><span class="o">:</span>       <span class="nt">e2504000</span>        <span class="nt">subs</span>    <span class="nt">r4</span><span class="o">,</span> <span class="nt">r0</span><span class="o">,</span> <span class="p">#</span><span class="nn">0</span>
<span class="nt">c0077660</span><span class="o">:</span>       <span class="nt">0a000027</span>        <span class="nt">beq</span>     <span class="nt">c0077704</span> <span class="o">&lt;</span><span class="nt">sys_setuid</span><span class="o">+</span><span class="nt">0xb4</span><span class="o">&gt;</span>
<span class="nt">c0077664</span><span class="o">:</span>       <span class="nt">e1a0200d</span>        <span class="nt">mov</span>     <span class="nt">r2</span><span class="o">,</span> <span class="nt">sp</span>
<span class="nt">c0077668</span><span class="o">:</span>       <span class="nt">e3c23d7f</span>        <span class="nt">bic</span>     <span class="nt">r3</span><span class="o">,</span> <span class="nt">r2</span><span class="o">,</span> <span class="p">#</span><span class="nn">8128</span>   <span class="o">;</span> <span class="nt">0x1fc0</span>
<span class="nt">c007766c</span><span class="o">:</span>       <span class="nt">e3c3303f</span>        <span class="nt">bic</span>     <span class="nt">r3</span><span class="o">,</span> <span class="nt">r3</span><span class="o">,</span> <span class="p">#</span><span class="nn">63</span>     <span class="o">;</span> <span class="nt">0x3f</span>
<span class="nt">c0077670</span><span class="o">:</span>       <span class="nt">e3a00007</span>        <span class="nt">mov</span>     <span class="nt">r0</span><span class="o">,</span> <span class="p">#</span><span class="nn">7</span>
<span class="nt">c0077674</span><span class="o">:</span>       <span class="nt">e593300c</span>        <span class="nt">ldr</span>     <span class="nt">r3</span><span class="o">,</span> <span class="cp">[</span><span class="nx">r3</span><span class="p">,</span> <span class="vi">#12</span><span class="cp">]</span>
<span class="nt">c0077678</span><span class="o">:</span>       <span class="nt">e59362fc</span>        <span class="nt">ldr</span>     <span class="nt">r6</span><span class="o">,</span> <span class="cp">[</span><span class="nx">r3</span><span class="p">,</span> <span class="vi">#764</span><span class="cp">]</span>  <span class="o">;</span> <span class="nt">0x2fc</span>
<span class="nt">c007767c</span><span class="o">:</span>       <span class="nt">ebffd80f</span>        <span class="nt">bl</span>      <span class="nt">c006d6c0</span> <span class="o">&lt;</span><span class="nt">nsown_capable</span><span class="o">&gt;</span>
<span class="nt">c0077680</span><span class="o">:</span>       <span class="nt">e3500000</span>        <span class="nt">cmp</span>     <span class="nt">r0</span><span class="o">,</span> <span class="p">#</span><span class="nn">0</span>
<span class="nt">c0077684</span><span class="o">:</span>       <span class="nt">1a00000a</span>        <span class="nt">bne</span>     <span class="nt">c00776b4</span> <span class="o">&lt;</span><span class="nt">sys_setuid</span><span class="o">+</span><span class="nt">0x64</span><span class="o">&gt;</span>
</code></pre></div>

<p>这里有另一篇分析 http://securityblog.org/2013/04/30/SE-Android-and-the-motochopper-exploit/</p>
    </div>
    <div class="post-footer">
        <span class="meta-prep">Post in</span>
        <abbr class="date" title="2013-10-17T13:10:58+08:00"> 
            <a href="./archive/2013/Oct/index.html">
                Oct 17 2013 </a>
        </abbr>
        <br />
        Published under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">(CC) BY-NC-SA</a>
        <span class="meta-prep"> with tags</span>
                <a href="./tag/security.html">Security</a>
                <a href="./tag/linux.html">linux</a>
    </div>
    <div class="clear"></div>
</artical>
<section>
    <div id="disqus_thread">
    <script type="text/javascript">
    var disqus_identifier = "cve-2013-2596.html";
    (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://ir193.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    </div>

</section>
            <div class="footer">
                Powered by <a href="http://getpelican.com/">Pelican</a> <br />
                which takes great advantage of <a href="http://python.org">Python</a> <br />
                <a title="Web Statistics" href="http://clicky.com/100758617"><img alt="Web Statistics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
            </div>
        </div>
    </div>
    <div class="pure-u-1 pure-u-md-6-24"> </div>
</div>


<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100758617); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100758617ns.gif" /></p></noscript>

</body>
</html>